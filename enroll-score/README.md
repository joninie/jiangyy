# 学校/专业的招生计划和录取分数OCR文件解析
输入OCR文件为excel格式，需要将其中的招生计划数据或者录取分数数据解析出来，输出文件为excel格式，一行一个学校/专业的信息。

## 目的
由于输入文件的格式花样百出，需要对一般性的内容格式有一套处理方式，特殊的内容格式特殊处理。

## 程序说明
使用python3.6， enroll/ 为招生计划的处理程序， score/ 为录取分数的处理程序，conf/ 为配置文件目录。

1. PageableParser 根据参数 page-column-count （每页列数）分页，将一行多个学校/专业的内容拆分成一行一个学校/专业；
2. HeaderParser 识别文件内容表头，表头的识别通过正则表达式，将匹配的结果保存在预定的字段，如果文件内容有新增的字段，可以添加到对应的HeaderParser中；
3. InfoParser 处理学校和专业的关系。

## OCR文件规则
如果院校或者专业信息的内容包含在同一列，如`‘2472苏州大学11人’`，请使用`‘不分列OCR文件内容规则’`，
如果院校或者专业信息的内容按列区分， 如`‘2472|苏州大学|11人’`，其中‘|’在excel中体现为列与列的分割，请使用`‘分列OCR文件内容规则’`。 
由于OCR文件格式不统一，为了便于程序解析OCR文件，需人为调整一下OCR文件内容的表头，以满足现有程序的处理规则。
当文件存在多行表头时，允许只修改第一行表头，其他表头行不需要修改，最好删除，否则可能被误认为学校或者专业出现在解析文件中。
目前程序可以处理的列有限， 详细见“不分列OCR文件内容规则”和“分列OCR文件内容规则”，如有新增列需要添加，请通知wujianzhen@ipin.com，添加新功能后方可使用解析程序。

### 不分列OCR文件内容规则
1. 如果OCR文件内容出现一行多个学校/专业，则需要分页处理，将一个学校/专业所占的列数作为参数 page-column-count 的值，页块之间必须通过空行分割。
2. `如果院校、专业信息包含在同一列，请将一行中院校内容实体类别以列表形式，如['院校代码','院校名称', '计划数']，作为sch_column_names（院校内容实体类别列表）参数的值，`
`专业内容实体类别以列表形式，如['专业代码','专业名称', '计划数']，作为major_column_names（专业内容实体类别列表）参数的值。`
3. 学校内容实体类别： `“院校代码”，“院校名称”，“计划数”，“校址”，“批次”，“文理”。`
4. 专业内容实体类别： `“院校代码”，“院校名称”，“专业代码”，“专业名称”，“计划数”，“学费”，“学制”，“文理”，“批次”，“校址”。`
5. `专业代码除'[]'两个特殊字符外，包括数字、字母长度限制在3个以内，如果超出不适合用。`
6. `院校代码除'[]'两个特殊字符外，包括数字、字母长度限制在3个及4个以上。`
7. 如果`文理`在单独一行，程序会自动识别。

### 分列OCR文件内容规则
1. 目前可以处理的列包括（允许部分不存在）`“院校专业名称”，“院校专业代码”，“计划数”，“录取数”，“最高分”，“最低分”，“平行志愿”，“征求志愿”，`
   `“服从志愿”，“年份”，“平均分”，“最低分与分数线差值”，“录取最低分位次”，“平均分与分数线差值”，“专业组代码”，“科目要求”，“学制”，“院校全称”，`
   `“批次”，“录取数分布”，“学费”，“文理”，“办学地点”，“备注”`。 在使用程序解析OCR文件时，请修改表头。
2. 如果一行有多个年份的录取分数，请将年份以['yyyy','yyyy','yyyy']格式作为参数 enroll-years 的值，注意：请保证年份的准确性，程序只校验年份的个数。
3. 如果OCR文件内容出现一行多个学校/专业，则需要分页处理，将一个学校/专业所占的列数作为参数 page-column-count 的值，页块之间必须通过空行分割。

### 输出文件规则
1. 不分列解析只输出一个文件，文件名与输入文件一致，文件格式为xlsx;
2. 分列解析会输出两个文件，xxx-major_info.xlsx 和 xxx-sch_info.xlsx， 其中xxx为输入文件名称， xxx-major_info.xlsx 为专业数据， xxx-sch_info.xlsx 为学校数据。

## 程序返回
返回一个列表，包含每个文件的处理结果，成功或者错误提示。

例如：

[(0, '文件/home/janze/PycharmProjects/OCR文件/2016上海录取/1-102.xlsx处理成功'),
(0, '文件/home/janze/PycharmProjects/OCR文件/2016上海录取/103-241.xlsx处理成功')]

返回码：

0：“文件处理成功”； 1：“输出错误，包括文件表不规范，分页参数错误等”； 2：“程序异常”。


## 程序调用

```python
from enroll_score_ocr_parser.enroll_score_parser import enroll_parser
from enroll_score_ocr_parser.enroll_score_parser import score_parser

if __name__ == '__main__':
    msg = enroll_parser("/home/janze/PycharmProjects/OCR文件/17浙江招生",
                  "/home/janze/PycharmProjects/OCR-format/17浙江招生",
                  6,
                  ['院校代码','院校名称', '计划数'],
                  ['专业代码','专业名称', '计划数'])

    msg = score_parser("/home/janze/PycharmProjects/OCR文件/2016上海录取",
                       "/home/janze/PycharmProjects/OCR-format/2016上海录取",
                       0, # 不需要分页
                       ['2013', '2014', '2015'])

```

